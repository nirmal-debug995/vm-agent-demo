trigger:
- main

pool:
  name: Default   # Must match your agent pool name

steps:

- script: echo "Pipeline started on VM Self-Hosted Agent"
  displayName: "Start Message"

- script: node -v
  displayName: "Check Node Version"

- script: npm install
  displayName: "Install Dependencies"

- script: |
    echo "Stopping old app if running..."
    pkill node || true
  displayName: "Stop Previous App"

- script: |
    echo "Starting Node App..."
    nohup node app.js > app.log 2>&1 &
  displayName: "Run Node App in Background"

- script: |
    echo "App started. Logs:"
    sleep 3
    cat app.log
  displayName: "Show App Logs"
